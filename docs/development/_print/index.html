<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.114.0"><link rel=canonical type=text/html href=https://drupalwxt.github.io/docs/development/><link rel=alternate type=application/rss+xml href=https://drupalwxt.github.io/docs/development/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=../../../images/favicon.ico><title>Development | Drupal WxT</title><meta name=description content><meta property="og:title" content="Development"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://drupalwxt.github.io/docs/development/"><meta itemprop=name content="Development"><meta itemprop=description content><meta name=twitter:card content="summary"><meta name=twitter:title content="Development"><meta name=twitter:description content><link rel=preload href=../../../scss/main.min.0f9ee2fdaf9dfdf073d7ee97b54bd9adde085c494b9ece0388f0ba96d7fb962a.css as=style><link href=../../../scss/main.min.0f9ee2fdaf9dfdf073d7ee97b54bd9adde085c494b9ece0388f0ba96d7fb962a.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.3.min.js integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-section><header><nav class="td-navbar navbar-dark js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=../../../><span class="navbar-brand__logo navbar-logo"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 957 440"><defs><style>.wxt_logo{fill:#000}@media screen{.wxt_logo{fill:#000}}</style></defs><g transform="matrix(1,0,0,0.99999897,-9.6901386,-462.70603)"><path class="wxt_logo" d="M784.76421 462.90748C731.02378 462.32641 692.43028 462.92058 670.00747 465.81109 627.01699 471.36234 581.50604 521.32921 561.29903 556.61298 533.1225 598.63518 502.75047 688.71895 456.44715 688.45762 410.14383 688.19629 383.3898 586.46163 342.35988 586.87543 301.32996 587.28923 280.41575 681.13815 217.75409 680.85877 155.09243 680.5794 106.13019 521.18393 92.880525 462.95097H9.6901386C24.231399 554.63077 61.332242 625.08552 95.037833 673.97611 111.89062 698.42134 130.8032 720.94553 152.498 738.83848c21.6948 17.89309 36.79435 31.32425 78.72656 32.7585S310.59454 703.98949 336.85386 703.15671C361.10529 702.38761 367.52311 727.21076 358.42907 743.27683 349.33503 759.3429 325.08792 786.58449 316.37192 811.63499c-12.46372 35.82204-15.98038 67.51171-15.21365 90.09597L386.18296 901.44462C386.97642 857.40138 414.64036 778.01003 458.37203 775.64864 484.4689 775.57768 530.7786 820.59899 544.6176 838.95024 558.4566 857.30149 569.7218 874.82986 594.71632 889.25345S654.60982 905.15482 687.79769 893.30218C732.03818 877.50249 754.42732 835.1839 767.75116 795.52174 781.07499 755.85945 787.08531 711.72939 791.59405 669.88643 796.10281 628.04332 797.61781 603.23233 801.78169 576.96002 802.6265 571.62968 804.64498 552.07124 822.78338 547.72943 840.92177 543.38762 966.89118 546.85344 966.89118 546.85344L967.11932 462.8124S838.50471 463.48815 784.76427 462.90708zM719.12466 548.42285C711.60107 623.14542 709.98489 698.34966 687.10247 768.40741 681.56172 784.77829 660.87745 829.58569 637.20824 815.5576 633.78894 813.58447 624.96399 804.15123 612.5065 787.66591 598.42641 769.03327 577.6579 741.58571 546.2944 720.92616c23.04304-22.95619 41.22858-51.28996 56.39684-76.19101C620.23787 615.92959 632.36107 591.69362 632.4233 591.56916 632.42347 591.5689 632.4641 591.48806 632.4641 591.48806 649.71879 556.9987 688.33393 540.78276 719.12466 548.42285z"/></g></svg></span><span class=navbar-brand__name>Drupal WxT</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=../../../docs/><span>WxT</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/drupalwxt target=_blank rel=noopener><span>GitHub</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/drupalwxt/wxt/releases target=_blank rel=noopener><span>Download</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search WxT" aria-label="Search WxT" autocomplete=off data-offline-search-index-json-src=../../../offline-search-index.e2ff68a0daeb7ba41fd373fde73aab7e.json data-offline-search-base-href=../../../ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=../../../docs/development/>Return to the regular view of this page</a>.</p></div><h1 class=title>Development</h1><ul><li>1: <a href=#pg-abad3371426d6e5f07eac51c06bea59a>Architecture</a></li><ul></ul><li>2: <a href=#pg-e6f51e4d79f2f4d871a918eefe1a8bd7>Composer</a></li><ul></ul><li>3: <a href=#pg-c7deef66a9e0647b6c4605072259d21a>Configuration Management</a></li><ul></ul><li>4: <a href=#pg-8fa457ca188d93864e93d13c694eefec>Performance</a></li><ul><li>4.1: <a href=#pg-61994ca0147a9d94adcfce1fd96be0f1>PostgreSQL</a></li><ul></ul><li>4.2: <a href=#pg-bfabe6230aceb985666d26eb9ba78a34>Redis</a></li><ul></ul><li>4.3: <a href=#pg-81920c3d250035c9087cc9745bf7bbe1>Varnish</a></li><ul></ul></ul><li>5: <a href=#pg-79b4d1f932ae16eae9acd3a1ea726455>Release Process</a></li><ul></ul><li>6: <a href=#pg-f0420a376dd49bb7dd0eaddf45fa2698>Theming</a></li><ul></ul><li>7: <a href=#pg-cab786e7f4e5db188aaf22e2110f0048>Versioning</a></li><ul></ul></ul><div class=content><p>This section provides information for developers who wish to help collaborate and improve <strong><a href=https://github.com/drupalwxt/wxt>Drupal WxT</a></strong>.</p></div></div><div class=td-content><h1 id=pg-abad3371426d6e5f07eac51c06bea59a>1 - Architecture</h1><p>The goal of <strong><a href=https://github.com/drupalwxt/wxt>Drupal WxT</a></strong> since the 4.1.x line is to make the installation profile very minimal by default but providing additional extensions that can be enabled as desired.</p><p>What WxT offers is some light enhancements to Drupal Core, mainly around security and performance, and integration with the Web Experience Toolkit. By default, the distribution offers minimal functionality to allow full customizations by users. However a great deal of optional extensions are available that can provide additional functionality generally beneficial to Government departments.</p><blockquote><p><strong>Note</strong>: In the future we are looking into providing a list of community modules that are build to work with the distribution but are &ldquo;out of tree&rdquo;.</p></blockquote><p>All of the optional modules are located in the <code>wxt_ext</code> folder named after WxT Extend and can be enabled during the initial site installation by passing the following flag via the drush cli:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>wxt_extension_configure_form.select_all<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;TRUE&#39;</span>
</span></span></code></pre></div><blockquote><p><strong>Note</strong>: If you wish to only install the minimum set of dependencies please remove the <code>wxt_extension_configure_form.select_all='TRUE'</code> flag in its entirety.</p></blockquote><p>In order to provide a list of the optional enabled extensions during the installation that can be checked, all that any module has to do is provide a <code>modulename.wxt_extension.yml</code> file in their root and they will be picked as installable during the profile install and also respond to the additional drush flag discussed above.</p><p>For more information on some of the history leading to this design:</p><ul><li><a href=https://www.drupal.org/project/wxt/issues/3182208>WxT Minimal Install</a></li><li><a href=https://www.drupal.org/project/wxt/issues/3182977>Roadmap for Drupal 9</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-e6f51e4d79f2f4d871a918eefe1a8bd7>2 - Composer</h1><div class="alert alert-warning" role=alert>A reminder that <strong><a href=https://getcomposer.org/download/>composer</a></strong> is required for the installation and updating of <strong><a href=https://github.com/drupalwxt/wxt>Drupal WxT</a></strong>.</div><p>We highly recommend using our <strong><a href=https://github.com/drupalwxt/wxt-project>Composer Project Template</a></strong> to build and maintain your WxT derived projectâ€™s codebase.</p><h2 id=getting-started>Getting Started</h2><p>The following command is all you need to get started:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>composer create-project drupalwxt/wxt-project:5.1.1 &lt;site-name&gt;
</span></span></code></pre></div><blockquote><p><strong>Note</strong>: For development you may also specify a branch using <code>drupalwxt/wxt-project:5.1.x-dev</code>.</p></blockquote><p>You can see a working example of a fully generated Composer Project Template over at:</p><ul><li><strong><a href=https://github.com/drupalwxt/site-wxt>Site WxT</a></strong></li></ul><p>Where the following is the command that was used for the initial generation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>composer create-project drupalwxt/wxt-project:5.1.1 site-wxt
</span></span></code></pre></div><blockquote><p><strong>Note</strong>: Remember to keep the <code>composer.json</code> and <code>composer.lock</code> files that exist above <code>docroot</code> in source control as they are controlling your dependencies.</p></blockquote><h2 id=maintenance>Maintenance</h2><p>List of common commands are as follows:</p><table><thead><tr><th>Task</th><th>Composer</th></tr></thead><tbody><tr><td>Installing a contrib project (latest version)</td><td><code>composer require drupal/PROJECT</code></td></tr><tr><td>Installing a contrib project (specific version)</td><td><code>composer require drupal/PROJECT:1.0.0-beta5</code></td></tr><tr><td>Updating all projects including Drupal Core</td><td><code>composer update</code></td></tr><tr><td>Updating a single contrib project</td><td><code>composer update drupal/PROJECT_NAME</code></td></tr><tr><td>Updating Drupal Core</td><td><code>composer update drupal/core</code></td></tr></tbody></table><blockquote><p><strong>Note</strong>: Composer is a <strong>dependency manager</strong> and helps us keep track of what code and at what version our application relies on so that it always get installed the right way on every copy of that application.</p></blockquote><h3 id=specifying-a-version>Specifying a version</h3><p>A specific version can be specified from the cli:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>composer require drupal/&lt;modulename&gt;:&lt;version&gt;
</span></span></code></pre></div><p>However please note if you specify a branch, such as 1.x you must add <code>-dev</code> to the end of the version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>composer require drupal/token:1.x-dev
</span></span></code></pre></div><h3 id=source-control>Source Control</h3><p>Taking a look at the <code>.gitignore</code> file, you will discover that certain directories, including all those directories containing contributed projects, are excluded from source control which is by design.</p><blockquote><p><strong>Note</strong>: Unlike <strong><a href=https://www.drush.org/latest/>Drush</a></strong> in a Composer derived project you should <strong>never commit your install dependencies to source control</strong>.</p></blockquote><p>Composer will create <code>composer.lock</code> file, which is a list of dependencies that were installed, and in which versions.</p><blockquote><p><strong>Note</strong>: In general you should always <strong>commit your <code>composer.lock</code> file to source control</strong> so that others via a quick <code>composer install</code> can have everything installed along with the correct versions specified in the <code>composer.lock</code> file.</p></blockquote><h3 id=how-to-update-drupal-core>How to update Drupal Core?</h3><p>Please <strong>don&rsquo;t add <code>drupal/core</code> to your project&rsquo;s composer.json</strong> since WxT manages Drupal Core for you along with the series of patches on top of it.</p><p>For example:</p><ul><li><code>drupalwxt/wxt:~5.2.0</code> will require Drupal Core 10.2.x</li><li><code>drupalwxt/wxt:~5.1.0</code> will require Drupal Core 10.1.x</li></ul><p>When you need to update Drupal Core as an example from 10.1.x to 10.2.x, all you would do is change your requirement for <code>drupalwxt/wxt</code> in your <code>composer.json</code> file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>composer require --no-update drupalwxt/wxt:~5.2.0
</span></span><span style=display:flex><span>composer update
</span></span></code></pre></div><h3 id=compatibility-table>Compatibility table</h3><table><thead><tr><th>WxT version</th><th>Drupal Core version</th><th>Drush version</th><th>PHP version</th></tr></thead><tbody><tr><td><code>5.2.x</code></td><td><code>10.2.x</code></td><td><code>>=12.4</code></td><td><code>8.2</code></td></tr><tr><td><code>5.1.x</code></td><td><code>10.1.x</code></td><td><code>>=12.1</code></td><td><code>8.1</code></td></tr></tbody></table></div><div class=td-content style=page-break-before:always><h1 id=pg-c7deef66a9e0647b6c4605072259d21a>3 - Configuration Management</h1><p>Drupal WxT thanks to the work done by the Acquia Team is able to use advanced
configuration management strategies.</p><p>At the moment this remains an opt-in process and you will have to add the
following modules to your <code>composer.json</code> before you add the code snippet
below to your <code>settings.php</code> file.</p><ul><li><strong><a href=https://www.drupal.org/project/config_split>Configuration Split</a></strong></li><li><strong><a href=https://www.drupal.org/project/config_ignore>Configuration Ignore</a></strong></li></ul><p>Once enabled all default configuration will be stored in <code>/sites/default/files/config/default/</code>
and then depending on your environment additionally configuration splits can
be leveraged depending on your <code>SDLC</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * Configuration Split for Configuration Management
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> *
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * WxT is following the best practices given by Acquia for configuration
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * management. The &#34;default&#34; configuration directory should be shared between
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * all multi-sites, and each multisite will override this selectively using
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * configuration splits.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> *
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * To disable this functionality simply set the following parameters:
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * $wxt_override_config_dirs = FALSE;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * $settings[&#39;config_sync_directory&#39;] = $dir . &#34;/config/$site_dir&#34;;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> *
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * See https://github.com/acquia/blt/blob/12.x/settings/config.settings.php
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * for more information.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>use</span> <span style=color:#000>Drupal\wxt\Robo\Common\EnvironmentDetector</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>isset</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>$wxt_override_config_dirs</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$wxt_override_config_dirs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>TRUE</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>$wxt_override_config_dirs</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$config_directories</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;sync&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>$repo_root</span> <span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#4e9a06>&#34;/var/www/html/sites/default/files/config/default&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;config_sync_directory&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>$repo_root</span> <span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#4e9a06>&#34;/var/www/html/sites/default/files/config/default&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>$split_filename_prefix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;config_split.config_split&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>isset</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>$config_directories</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;sync&#39;</span><span style=color:#000;font-weight:700>]))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$split_filepath_prefix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>$config_directories</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;sync&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#4e9a06>&#39;/&#39;</span> <span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#000>$split_filename_prefix</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$split_filepath_prefix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;config_sync_directory&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#4e9a06>&#39;/&#39;</span> <span style=color:#ce5c00;font-weight:700>.</span> <span style=color:#000>$split_filename_prefix</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * Set environment splits.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> */</span>
</span></span><span style=display:flex><span><span style=color:#000>$split_envs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;local&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;dev&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;test&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;qa&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;prod&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#39;ci&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>foreach</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>$split_envs</span> <span style=color:#204a87;font-weight:700>as</span> <span style=color:#000>$split_env</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$config</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>$split_filename_prefix</span><span style=color:#4e9a06>.</span><span style=color:#4e9a06>$split_env</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;status&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>FALSE</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>isset</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>$split</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$split</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>EnvironmentDetector</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#c4a000>isLocalEnv</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>$split</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;local&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>EnvironmentDetector</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#c4a000>isCiEnv</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>$split</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;ci&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>EnvironmentDetector</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#c4a000>isDevEnv</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>$split</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;dev&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>elseif</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>EnvironmentDetector</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#c4a000>isTestEnv</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>$split</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;test&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>elseif</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>EnvironmentDetector</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#c4a000>isQaEnv</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>$split</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;qa&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>elseif</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>EnvironmentDetector</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#c4a000>isProdEnv</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>$split</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;prod&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>$split</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$config</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>$split_filename_prefix</span><span style=color:#4e9a06>.</span><span style=color:#4e9a06>$split</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;status&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>TRUE</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * Set multisite split.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> */</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// $config[&#34;$split_filename_prefix.SITENAME&#34;][&#39;status&#39;] = TRUE;
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-8fa457ca188d93864e93d13c694eefec>4 - Performance</h1><p>Below are some recommended settings that improve the performance of <strong><a href=https://github.com/drupalwxt/wxt>Drupal WxT</a></strong> sites.</p></div><div class=td-content><h1 id=pg-61994ca0147a9d94adcfce1fd96be0f1>4.1 - PostgreSQL</h1><p>To properly configure PostgreSQL with Drupal you should ensure the following configuration is used.</p><blockquote><p><strong>Note</strong>: Some customizations might be necessary depending on your individual requirements.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>postgresqlConfiguration:
</span></span><span style=display:flex><span>  listenAddresses: <span style=color:#4e9a06>&#34;&#39;*&#39;&#34;</span>
</span></span><span style=display:flex><span>  maxConnections: <span style=color:#4e9a06>&#34;200&#34;</span>
</span></span><span style=display:flex><span>  sharedBuffers: 512MB
</span></span><span style=display:flex><span>  workMem: 2048MB
</span></span><span style=display:flex><span>  effectiveCacheSize: 512MB
</span></span><span style=display:flex><span>  effectiveIoConcurrency: <span style=color:#4e9a06>&#34;100&#34;</span>
</span></span><span style=display:flex><span>  maintenanceWorkMem: 32MB
</span></span><span style=display:flex><span>  minWalSize: 512MB
</span></span><span style=display:flex><span>  maxWalSize: 512MB
</span></span><span style=display:flex><span>  walBuffers: 8048kB
</span></span><span style=display:flex><span>  byteaOutput: <span style=color:#4e9a06>&#34;&#39;escape&#39;&#34;</span>
</span></span><span style=display:flex><span>  hugePages: <span style=color:#4e9a06>&#34;off&#34;</span>
</span></span><span style=display:flex><span>  walLevel: <span style=color:#4e9a06>&#34;replica&#34;</span>
</span></span><span style=display:flex><span>  maxWalSenders: <span style=color:#4e9a06>&#34;0&#34;</span>
</span></span><span style=display:flex><span>  synchronousCommit: <span style=color:#4e9a06>&#34;on&#34;</span>
</span></span><span style=display:flex><span>  walKeepSegments: <span style=color:#4e9a06>&#34;130&#34;</span>
</span></span><span style=display:flex><span>  checkpointTimeout: <span style=color:#4e9a06>&#34;&#39;15 min&#39;&#34;</span>
</span></span><span style=display:flex><span>  checkpointCompletionTarget: <span style=color:#4e9a06>&#34;0.9&#34;</span>
</span></span><span style=display:flex><span>  walCompression: <span style=color:#4e9a06>&#34;on&#34;</span>
</span></span><span style=display:flex><span>  walWriterDelay: 200ms
</span></span><span style=display:flex><span>  walWriterFlushAfter: 1MB
</span></span><span style=display:flex><span>  bgwriterDelay: 200ms
</span></span><span style=display:flex><span>  bgwriterLruMaxpages: <span style=color:#4e9a06>&#34;100&#34;</span>
</span></span><span style=display:flex><span>  bgwriterLruMultiplier: <span style=color:#4e9a06>&#34;2.0&#34;</span>
</span></span><span style=display:flex><span>  bgwriterFlushAfter: <span style=color:#4e9a06>&#34;0&#34;</span>
</span></span><span style=display:flex><span>  maxWorkerProcesses: <span style=color:#4e9a06>&#34;8&#34;</span>
</span></span><span style=display:flex><span>  maxParallelWorkersPerGather: <span style=color:#4e9a06>&#34;4&#34;</span>
</span></span><span style=display:flex><span>  maxParallelWorkers: <span style=color:#4e9a06>&#34;4&#34;</span>
</span></span></code></pre></div><blockquote><p><strong>Note</strong>: The above is written in yaml syntax which will work for both Docker Compose and Kubernetes Helm Charts. For the <code>postgresql.conf</code> file itself without using these tools simply find the <code>_</code> counterpart.</p></blockquote><h4 id=queries-leveraging-ilike>Queries leveraging ILIKE</h4><p>There is a known PostgreSQL performance issue that exists in Drupal and is related to leveraging queries with <code>ILIKE</code>.</p><p>This issue is particularly noticeable in relation to the path_alias table.</p><p>There are patches being worked on to handle this in Drupal core but a very quick fix can be implemented leveraging pg_trgm.</p><p>There is a great blog article listed below which goes over this issue in more detail.</p><ul><li><strong><a href=https://ferfebles.github.io/2018/04/16/Improving-large-Drupal-Postgres-performance-by-using-pg_trgm.html>Improving Drupal Postgres Performance</a></strong></li></ul><p>The instructions are a bit outdated so the updated syntax to enter in psql is given below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>CREATE EXTENSION pg_trgm<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>CREATE INDEX path_alias__alias_trgm_gist_idx ON path_alias USING gist <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87>alias</span> gist_trgm_ops<span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>CREATE INDEX path_alias__path_trgm_gist_idx ON path_alias USING gist <span style=color:#ce5c00;font-weight:700>(</span>path gist_trgm_ops<span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>ANALYZE path_alias<span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-bfabe6230aceb985666d26eb9ba78a34>4.2 - Redis</h1><p>To properly configure Redis with Drupal you should ensure the following configuration is added to your <code>settings.php</code> file.</p><blockquote><p><strong>Note</strong>: Some customizations might be necessary depending on your individual requirements.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>extension_loaded</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;redis&#39;</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Set Redis as the default backend for any cache bin not otherwise specified.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;cache&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;default&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cache.backend.redis&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;redis.connection&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;interface&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;PhpRedis&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;redis.connection&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;scheme&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;http&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;redis.connection&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;host&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;localhost&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;redis.connection&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;port&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;6379&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;redis.connection&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;password&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>getenv</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;REDIS_PASSWORD&#39;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>?:</span> <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;redis.connection&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;persistent&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>FALSE</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Allow the services to work before the Redis module itself is enabled.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;container_yamls&#39;</span><span style=color:#000;font-weight:700>][]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;modules/contrib/redis/example.services.yml&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;container_yamls&#39;</span><span style=color:#000;font-weight:700>][]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;modules/contrib/redis/redis.services.yml&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Manually add the classloader path, this is required for the container cache bin definition below
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// and allows to use it without the redis module being enabled.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>$class_loader</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#c4a000>addPsr4</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Drupal\\redis\\&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;modules/contrib/redis/src&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;bootstrap_container_definition&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#39;parameters&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[],</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#39;services&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#39;redis.factory&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;class&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#39;Drupal\redis\ClientFactory&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#39;cache.backend.redis&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;class&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#39;Drupal\redis\Cache\CacheBackendFactory&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;arguments&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;@redis.factory&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;@cache_tags_provider.container&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;@serialization.phpserialize&#39;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#39;cache.container&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;class&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#39;\Drupal\redis\Cache\PhpRedis&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;factory&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;@cache.backend.redis&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;get&#39;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;arguments&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;container&#39;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#39;cache_tags_provider.container&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;class&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#39;Drupal\redis\Cache\RedisCacheTagsChecksum&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;arguments&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;@redis.factory&#39;</span><span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#39;serialization.phpserialize&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;class&#39;</span> <span style=color:#ce5c00;font-weight:700>=&gt;</span> <span style=color:#4e9a06>&#39;Drupal\Component\Serialization\PhpSerialize&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>];</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>/** Optional prefix for cache entries */</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;cache_prefix&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;drupal_&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Always set the fast backend for bootstrap, discover and config, otherwise
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// this gets lost when redis is enabled.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;cache&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;bins&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;bootstrap&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cache.backend.chainedfast&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;cache&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;bins&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;discovery&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cache.backend.chainedfast&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;cache&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;bins&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;config&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cache.backend.chainedfast&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Use for all bins otherwise specified.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;cache&#39;</span><span style=color:#000;font-weight:700>][</span><span style=color:#4e9a06>&#39;default&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cache.backend.redis&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Use for all queues unless otherwise specified for a specific queue.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>$settings</span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;queue_default&#39;</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;queue.redis&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Or if you want to use reliable queue implementation.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// $settings[&#39;queue_default&#39;] = &#39;queue.redis_reliable&#39;;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Use this to only use Redis for a specific queue.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// $settings[&#39;queue_service_aggregator_feeds&#39;] = &#39;queue.redis&#39;;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Use this to use reliable queue implementation.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// $settings[&#39;queue_service_aggregator_feeds&#39;] = &#39;queue.redis_reliable&#39;;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-81920c3d250035c9087cc9745bf7bbe1>4.3 - Varnish</h1><p>To properly configure Varnish with Drupal you should ensure the following configuration is your <code>default.vcl</code> file.</p><blockquote><p><strong>Note</strong>: Some customizations might be necessary depending on your individual requirements.</p></blockquote><pre tabindex=0><code class=language-vcl data-lang=vcl>vcl 4.0;

import std;
import directors;

backend nginx {
  .host = &#34;hostname-nginx&#34;;
  .host_header = &#34;hostname-nginx&#34;;
  .port = &#34;80&#34;;
}

sub vcl_init {
  new backends = directors.round_robin();
  backends.add_backend(nginx);
}

sub vcl_recv {
  set req.http.X-Forwarded-Host = req.http.Host;
  if (!req.http.X-Forwarded-Proto) {
    set req.http.X-Forwarded-Proto = &#34;http&#34;;
  }

  # Answer healthcheck
  if (req.url == &#34;/_healthcheck&#34; || req.url == &#34;/healthcheck.txt&#34;) {
    return (synth(700, &#34;HEALTHCHECK&#34;));
  }
  set req.backend_hint = backends.backend();

  # Answer healthcheck
  if (req.url == &#34;/_healthcheck&#34; || req.url == &#34;/healthcheck.txt&#34;) {
    return (synth(700, &#34;HEALTHCHECK&#34;));
  }
  set req.backend_hint = backends.backend();

  # Always cache certain file types
  # Remove cookies that Drupal doesn&#39;t care about
  if (req.url ~ &#34;(?i)\.(asc|dat|tgz|png|gif|jpeg|jpg|ico|swf|css|js)(\?.*)?$&#34;) {
    unset req.http.Cookie;
  } else if (req.http.Cookie) {
    set req.http.Cookie = &#34;;&#34; + req.http.Cookie;
    set req.http.Cookie = regsuball(req.http.Cookie, &#34;; +&#34;, &#34;;&#34;);
    set req.http.Cookie = regsuball(req.http.Cookie, &#34;;(SESS[a-z0-9]+|SSESS[a-z0-9]+|NO_CACHE)=&#34;, &#34;; \1=&#34;);
    set req.http.Cookie = regsuball(req.http.Cookie, &#34;;[^ ][^;]*&#34;, &#34;&#34;);
    set req.http.Cookie = regsuball(req.http.Cookie, &#34;^[; ]+|[; ]+$&#34;, &#34;&#34;);
    if (req.http.Cookie == &#34;&#34;) {
        unset req.http.Cookie;
    } else {
        return (pass);
    }
  }
  # If POST, PUT or DELETE, then don&#39;t cache
  if (req.method == &#34;POST&#34; || req.method == &#34;PUT&#34; || req.method == &#34;DELETE&#34;) {
    return (pass);
  }
  # Happens before we check if we have this in cache already.
  #
  # Typically you clean up the request here, removing cookies you don&#39;t need,
  # rewriting the request, etc.
  return (hash);
  #return (pass);
}

sub vcl_backend_fetch {
  # NEW
  set bereq.http.Host = &#34;hostname-nginx&#34;;

  # Don&#39;t add 127.0.0.1 to X-Forwarded-For
  set bereq.http.X-Forwarded-For = regsub(bereq.http.X-Forwarded-For, &#34;(, )?127\.0\.0\.1$&#34;, &#34;&#34;);
}

sub vcl_backend_response {
  if (beresp.http.Location) {
    set beresp.http.Location = regsub(
      beresp.http.Location,
      &#34;^https?://[^/]+/&#34;,
      bereq.http.X-Forwarded-Proto + &#34;://&#34; + bereq.http.X-Forwarded-Host + &#34;/&#34;
    );
  }
  # Only cache select response codes
  if (beresp.status == 200 || beresp.status == 203 || beresp.status == 204 || beresp.status == 206 || beresp.status == 300 || beresp.status == 301 || beresp.status == 404 || beresp.status == 405 || beresp.status == 410 || beresp.status == 414 || beresp.status == 501) {
    # Cache for 5 minutes
    set beresp.ttl = 5m;
    set beresp.grace = 12h;
    set beresp.keep = 24h;
  } else {
    set beresp.ttl = 0s;
  }
}

sub vcl_deliver {
  # Remove identifying information
  unset resp.http.Server;
  unset resp.http.X-Powered-By;
  unset resp.http.X-Varnish;
  unset resp.http.Via;

  # Comment these for easier Drupal cache tag debugging in development.
  unset resp.http.Cache-Tags;
  unset resp.http.X-Drupal-Cache-Contexts;

  # Add Content-Security-Policy
  # set resp.http.Content-Security-Policy = &#34;default-src &#39;self&#39; *.example.ca *.example.ca; style-src &#39;self&#39; &#39;unsafe-inline&#39; *.example.ca https://fonts.googleapis.com; script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; *.example.ca  *.adobedtm.com use.fontawesome.com blob:; connect-src &#39;self&#39; *.example.ca *.omtrdc.net *.demdex.net *.everesttech.net; img-src &#39;self&#39; *.example.ca *.omtrdc.net *.demdex.net *.everesttech.net data:; font-src &#39;self&#39; *.example.ca https://fonts.gstatic.com&#34;;

  # Add CORS Headers
  # if (req.http.Origin ~ &#34;(?i)\.example\.ca$&#34;) {
  #   if (req.url ~ &#34;\.(ttd|woff|woff2)(\?.*)?$&#34;) {
  #     set resp.http.Access-Control-Allow-Origin = &#34;*&#34;;
  #     set resp.http.Access-Control-Allow-Methods = &#34;GET&#34;;
  #   }
  # }

  # Add X-Frame-Options
  if (req.url ~ &#34;^/livechat&#34; || req.url ~ &#34;^/(en/|fr/)?entity-browser/&#34;) {
    set resp.http.X-Frame-Options = &#34;SAMEORIGIN&#34;;
  } else {
    set resp.http.X-Frame-Options = &#34;DENY&#34;;
  }

  set resp.http.X-Content-Type-Options = &#34;nosniff&#34;;
  set resp.http.X-XSS-Protection = &#34;1; mode=block&#34;;

  # Happens when we have all the pieces we need, and are about to send the
  # response to the client.
  #
  # You can do accounting or modifying the final object here.
  if (obj.hits &gt; 0) {
    set resp.http.X-Cache = &#34;HIT&#34;;
  } else {
    set resp.http.X-Cache = &#34;MISS&#34;;
  }
  # Handle errors
  if ( (resp.status &gt;= 500 &amp;&amp; resp.status &lt;= 599)
    || resp.status == 400
    || resp.status == 401
    || resp.status == 403
    || resp.status == 404) {
    return (synth(resp.status));
  }
}

sub vcl_synth {
  # Remove identifying information
  unset resp.http.Server;
  unset resp.http.X-Powered-By;
  unset resp.http.X-Varnish;
  unset resp.http.Via;

  # Add Content-Security-Policy
  # set resp.http.Content-Security-Policy = &#34;default-src &#39;self&#39; *.example.ca; style-src &#39;self&#39; &#39;unsafe-inline&#39; *.example.ca; script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; *.example.ca *.adobedtm.com use.fontawesome.com blob:; connect-src &#39;self&#39; *.example.ca *.omtrdc.net *.demdex.net *.everesttech.net; img-src &#39;self&#39; *.example.ca data:;&#34;;
  # set resp.http.X-Content-Type-Options = &#34;nosniff&#34;;
  # set resp.http.X-Frame-Options = &#34;DENY&#34;;
  # set resp.http.X-XSS-Protection = &#34;1; mode=block&#34;;

  # if (resp.status &gt;= 500 &amp;&amp; resp.status &lt;= 599) {
  #   set resp.http.Content-Type = &#34;text/html; charset=utf-8&#34;;
  #   synthetic(std.fileread(&#34;/data/configuration/varnish/errors/503.html&#34;));
  #   return (deliver);
  # } elseif (resp.status == 400) { # 400 - Bad Request
  #   set resp.http.Content-Type = &#34;text/html; charset=utf-8&#34;;
  #   synthetic(std.fileread(&#34;/data/configuration/varnish/errors/400.html&#34;));
  #   return (deliver);
  # } elseif (resp.status == 401) { # 401 - Unauthorized
  #   set resp.http.Content-Type = &#34;text/html; charset=utf-8&#34;;
  #   synthetic(std.fileread(&#34;/data/configuration/varnish/errors/401.html&#34;));
  #   return (deliver);
  # } elseif (resp.status == 403) { # 403 - Forbidden
  #   set resp.http.Content-Type = &#34;text/html; charset=utf-8&#34;;
  #   synthetic(std.fileread(&#34;/data/configuration/varnish/errors/403.html&#34;));
  #   return (deliver);
  # } elseif (resp.status == 404) { # 404 - Not Found
  #   set resp.http.Content-Type = &#34;text/html; charset=utf-8&#34;;
  #   synthetic(std.fileread(&#34;/data/configuration/varnish/errors/404.html&#34;));
  #   return (deliver);
  # } else
  if (resp.status == 700) { # Respond to healthcheck
    set resp.status = 200;
    set resp.http.Content-Type = &#34;text/plain&#34;;
    synthetic ( {&#34;OK&#34;} );
    return (deliver);
  }
}

##
# ERROR HANDLING
##
# sub vcl_backend_error {
#   set beresp.http.Content-Type = &#34;text/html; charset=utf-8&#34;;
#   synthetic(std.fileread(&#34;/data/configuration/varnish/errors/503.html&#34;));
#   return (deliver);
# }
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-79b4d1f932ae16eae9acd3a1ea726455>5 - Release Process</h1><h2 id=select-a-version-number>Select a version number</h2><p>WxT releases are numbered using a form of semantic versioning. More information can be found in our <strong><a href=../../../docs/development/version/>Versioning</a></strong> page.</p><p><code>MAJOR.FEATURE.SPRINT</code></p><p>In general, when preparing a release: increment the FEATURE when Drupal Core has a major release (ie. 9.5.x to 10.0.x) otherwise simply increment the SPRINT number.</p><h2 id=create-an-issue-on-githubcom>Create an issue on GitHub.com</h2><p>Create an issue in the <strong><a href=https://github.com/drupalwxt/wxt>Drupal WxT</a></strong> project on GitHub for release tracking, title it <code>Release x.x.x</code> (where x.x.x is the incremented version number).</p><p>This issue should contain the following checklist as well as any other related steps or information regarding preparing the release.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>See the <span style=color:#ce5c00;font-weight:700>[</span>full release documentation<span style=color:#ce5c00;font-weight:700>](</span>https://drupalwxt.github.io/docs/development/release-process/<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>for</span> more detail.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#ce5c00;font-weight:700>]</span> All related projects <span style=color:#ce5c00;font-weight:700>(</span>wxt_library and wxt_bootstrap<span style=color:#ce5c00;font-weight:700>)</span> tagged and released on GitHub.com and Drupal.org
</span></span><span style=display:flex><span>- <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#ce5c00;font-weight:700>]</span> Version number selected
</span></span><span style=display:flex><span>- <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#ce5c00;font-weight:700>]</span> CHANGELOG.md updated
</span></span><span style=display:flex><span>- <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#ce5c00;font-weight:700>]</span> composer.json updated
</span></span><span style=display:flex><span>- <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#ce5c00;font-weight:700>]</span> Run version.sh <span style=color:#204a87;font-weight:700>for</span> hook_updates and wxt contrib
</span></span><span style=display:flex><span>- <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#ce5c00;font-weight:700>]</span> CI build passes
</span></span><span style=display:flex><span>- <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#ce5c00;font-weight:700>]</span> Releases tagged and pushed to GitHub.com and Drupal.org
</span></span><span style=display:flex><span>- <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#ce5c00;font-weight:700>]</span> WxT released on Drupal.org <span style=color:#ce5c00;font-weight:700>(</span>https://drupalwxt.github.io/docs/development/release-process/#release<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>- <span style=color:#ce5c00;font-weight:700>[</span> <span style=color:#ce5c00;font-weight:700>]</span> Add changelog information to published tag once CI is <span style=color:#204a87;font-weight:700>done</span>
</span></span></code></pre></div><h2 id=update-changelog>Update changelog</h2><p>Ensure the changelog contains an entry for the release and is updated as issues and changes are resolved (in the next steps or when committing code / changes).</p><h2 id=review-dependent-wxt-modules>Review dependent wxt modules</h2><ol><li>Review contrib modules in composer.json (or in a site install; extend->update) and update as necessary.</li><li>If necessary, tag <strong><a href=https://github.com/drupalwxt/wxt_library>wxt_library</a></strong> and update <strong><a href=https://github.com/drupalwxt/wxt>wxt</a></strong>&rsquo;s <code>composer.json</code> file</li><li>If necessary, tag <strong><a href=https://github.com/drupalwxt/wxt_bootstrap>wxt_bootstrap</a></strong> and update <strong><a href=https://github.com/drupalwxt/wxt>wxt</a></strong>&rsquo;s <code>composer.json</code> file</li></ol><p>All projects must be released on drupal.org (and github).</p><blockquote><p><strong>Note</strong>: Changes to <code>composer.json</code> file (specifically dev dependencies and repositories) should be mentioned in the CHANGELOG.</p></blockquote><h3 id=drupalorg-version>Drupal.org version</h3><p>Drupal.org does not currently support semantic versioning. Instead, the version number on drupal.org is <code>10.x-X.YZZ</code>, where:</p><ul><li><code>X = MAJOR</code></li><li><code>Y = FEATURE</code></li><li><code>ZZ = SPRINT</code> (two digits - add leading zero for &lt; 10)</li></ul><h2 id=check-composerjson>Check composer.json</h2><p>If the wxt dependent modules are updated, we need to reflect this in wxt <code>composer.json</code> and the CHANGELOG.</p><ul><li><code>git clone https://github.com/drupalwxt/wxt.git</code></li><li>Confirm or update that it&rsquo;s using appropriate tags of <strong><a href=https://github.com/drupalwxt/wxt_library>wxt_library</a></strong> + <strong><a href=https://github.com/drupalwxt/wxt_bootstrap>wxt_bootstrap</a></strong> (<code>composer.json</code>)</li><li>Push to github.com and drupal.org repositories any changes</li><li>Ensure GitHub Actions build passes</li></ul><h2 id=tag-wxt>Tag WxT</h2><h3 id=githubcom-and-drupalorg>GitHub.com and Drupal.org</h3><ul><li><code>git tag MAJOR.FEATURE.SPRINT</code></li><li><code>git push $GITHUB_REMOTE MAJOR.FEATURE.SPRINT</code></li></ul><h2 id=release>Release</h2><h3 id=githubcom>GitHub.com</h3><ol><li>Go to <strong><a href=https://github.com/drupalwxt/wxt/tags>Tags</a></strong> page</li><li>Click &mldr; and select create release on the tag</li><li>Enter the version number in the <em>release title</em></li><li>Copy the changelog entry for this release into the <code>release notes</code></li><li>Click publish release</li></ol><h3 id=drupalorg>Drupal.org</h3><p>The builds on Drupal.org are incomplete as they don&rsquo;t fully support Composer yet which is why we host a tarball on GitHub for those not using Composer.</p><ol><li><strong><a href=https://www.drupal.org/node/add/project-release/2619112>Drupal WxT Release Page</a></strong></li><li>Select the tag</li><li>Copy/paste the following blurb into the release notes:</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>&lt;strong&gt;CHANGELOG&lt;/strong&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>See the &lt;a <span style=color:#000>href</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;https://github.com/drupalwxt/wxt/blob/5.2.x/CHANGELOG.md&#34;</span>&gt;changelog.md&lt;/a&gt; file.
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-f0420a376dd49bb7dd0eaddf45fa2698>6 - Theming</h1><p>Largely when doing any theme related work with <strong><a href=https://github.com/drupalwxt/wxt>Drupal WxT</a></strong> this almost always should be done in a sub-theme.</p><p>For more on creating sub-themes please consult the official documentation:</p><ul><li><strong><a href=https://www.drupal.org/docs/theming-drupal/creating-sub-themes>Creating sub-themes</a></strong></li></ul><p>To assist with sub-theme creation <strong><a href=https://www.drupal.org/project/wxt_bootstrap>WxT Bootstrap</a></strong> provides an example starterkit that should be of benefit.</p><blockquote><p><strong>Note</strong>: Sub-themes are just like any other theme except they inherit the parent theme&rsquo;s resources.</p></blockquote><h2 id=sub-theme-configuration>Sub Theme Configuration</h2><p>a) Replace every instance of <code>THEMENAME</code> with your chosen machine name often of the pattern <code>&lt;prefix>_bootstrap</code>.</p><p>b) Enable your new sub-theme preferably via <strong><a href=https://www.drush.org/latest/>drush</a></strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>drush en <span style=color:#4e9a06>`</span>&lt;prefix&gt;_bootstrap<span style=color:#4e9a06>`</span>
</span></span><span style=display:flex><span>drush cc css-js
</span></span></code></pre></div><p>c) Point to your new sub theme for <strong><a href=https://www.drupal.org/project/wxt_library>WxT Library</a></strong> to properly load assets under <strong>Themes Visibility</strong> on the <code>/admin/config/wxt/wxt_library</code> page.</p><h2 id=notes>Notes</h2><h3 id=inheriting-block-templates>Inheriting Block Templates</h3><p>If the theme you are extending has custom block templates these won&rsquo;t be immediately inherited because a sub-theme creates copies of all the blocks in the parent theme and renames them with the sub-theme&rsquo;s name as a prefix. Twig block templates are derived from the block&rsquo;s name, so this breaks the link between these templates and their block.</p><p>Fixing this problem currently requires a hook in the <code>THEMENAME.theme</code> file and should have the following contents:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>/**
</span></span><span style=display:flex><span> * Implements hook_theme_suggestions_HOOK_alter<span style=color:#ce5c00;font-weight:700>()</span>.
</span></span><span style=display:flex><span> */
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> THEMENAME_theme_suggestions_block_alter<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000;font-weight:700>&amp;</span><span style=color:#000>$suggestions</span>, <span style=color:#000>$variables</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  // Load theme suggestions <span style=color:#204a87;font-weight:700>for</span> blocks from parent theme.
</span></span><span style=display:flex><span>  // https://www.drupal.org/project/wxt/issues/3310485#comment-14715969
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$i</span> <span style=color:#ce5c00;font-weight:700>=</span> 0<span style=color:#000;font-weight:700>;</span> <span style=color:#000>$i</span> &lt; count<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$suggestions</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>$i</span>++<span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span>str_contains<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$suggestions</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>$i</span><span style=color:#ce5c00;font-weight:700>]</span>, <span style=color:#4e9a06>&#39;THEMENAME_&#39;</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>$new_suggestions</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>        str_replace<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;THEMENAME_&#39;</span>, <span style=color:#4e9a06>&#39;&#39;</span>, <span style=color:#000>$suggestions</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>$i</span><span style=color:#ce5c00;font-weight:700>])</span>,
</span></span><span style=display:flex><span>        str_replace<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;THEMENAME_&#39;</span>, <span style=color:#4e9a06>&#39;wxt_bootstrap_&#39;</span>, <span style=color:#000>$suggestions</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>$i</span><span style=color:#ce5c00;font-weight:700>])</span>,
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>]</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      array_splice<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>$suggestions</span>, <span style=color:#000>$i</span>, 0, <span style=color:#000>$new_suggestions</span><span style=color:#ce5c00;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#000>$i</span> +<span style=color:#ce5c00;font-weight:700>=</span> 2<span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=programmatic-logic>Programmatic Logic</h3><p>The following provides an example of how you can configure your sub theme to be installed as the default on a module install:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#8f5902;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> * Implements hook_modules_installed().
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic> */</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>MODULENAME_modules_installed</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>$modules</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>in_array</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;wxt&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>$modules</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>\Drupal</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#c4a000>configFactory</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#c4a000>getEditable</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;system.theme&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#c4a000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;default&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;THEMENAME&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#c4a000>set</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;admin&#39;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;claro&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#c4a000>save</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>TRUE</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The following provides an example of how you can configure <code>wxt_library</code> to use your sub theme by creating a <code>config/install/wxt_library.settings.yml</code> file with the following contents:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>visibility</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>pages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;admin*&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;imagebrowser*&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;img_assist*&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;imce*&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;node/add/*&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;node/*/edit&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;print/*&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;printpdf/*&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;system/ajax&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#4e9a06>&#39;system/ajax/*&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>theme</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>visibility</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>themes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>THEMENAME</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>THEMENAME</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>wxt_bootstrap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>wxt_bootstrap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>minimized</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>options</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>files</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>types</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>css</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>css</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>js</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>js</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>wxt</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>theme</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>theme-gcweb</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-cab786e7f4e5db188aaf22e2110f0048>7 - Versioning</h1><p>The <strong><a href=https://github.com/drupalwxt/wxt>Drupal WxT</a></strong> distribution is following semantic versioning.</p><p>WxT typically makes a sprint release every four to six weeks. We will also use sprint releases to package new minor releases of Drupal Core with WxT as they become available.</p><p>In addition, we will also increment the major version number of WxT about once every four to six months.</p><h2 id=extensions>Extensions</h2><p>Support for semantic versioning for extensions (modules, themes, etc) is still ongoing.</p><ul><li><strong><a href=https://www.drupal.org/project/drupal/issues/3009338>Support semantic versioning for extensions (modules, themes, etc)</a></strong></li></ul><p>The three parts of our versioning system are MAJOR.FEATURE.SPRINT.</p><p>Given the following tag: 10.x-2.00:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>10</strong></td><td>Major version of Drupal Core</td></tr><tr><td><strong>x</strong></td><td></td></tr><tr><td><strong>5</strong></td><td>Major version of WxT</td></tr><tr><td><strong>0</strong></td><td>Feature release of WxT. Also increments with minor core releases.</td></tr><tr><td><strong>0</strong></td><td>Sprint release between feature releases</td></tr></tbody></table><blockquote><p><strong>Note</strong>: Due to the constraints of drupal.org, there is no separator between the FEATURE and SPRINT digits.</p></blockquote></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Drupal WxT Discussions" aria-label="Drupal WxT Discussions"><a target=_blank rel=noopener href=https://github.com/drupalwxt/wxt/discussions aria-label="Drupal WxT Discussions"><i class="fas fa-users"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Contributions Wanted" aria-label="Contributions Wanted"><a target=_blank rel=noopener href=https://github.com/drupalwxt/wxt aria-label="Contributions Wanted"><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Drupal Issue Queue" aria-label="Drupal Issue Queue"><a target=_blank rel=noopener href=https://drupal.org/project/issues/wxt aria-label="Drupal Issue Queue"><i class="fab fa-drupal"></i></a></li></ul></div><div class="col-6 col-sm-4 text-end text-xs-center order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="GitHub Pages" aria-label="GitHub Pages"><a target=_blank rel=noopener href=https://github.com/drupalwxt/drupalwxt.github.io aria-label="GitHub Pages"><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__copyright-etc col-12 col-sm-4 text-center py-2 order-sm-2"><span>&copy; 2024 Drupal WxT All Rights Reserved</span>
<span class=ms-1><a href=https://www.linuxfoundation.org/legal/privacy-policy target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js integrity="sha512-ku2nmBrzAXY5YwohzTqLYH1/lvyMrpTVxgQKrvTabd/b/uesqltLORdmpVapYv6QhZVCLUX6wkvFaKOAY4xpUA==" crossorigin=anonymous></script>
<script src=../../../js/main.min.a0ee49b4702cbaeb6728b1064a964a21fc2cd7d03364bbaa508cfb2f1af65935.js integrity="sha256-oO5JtHAsuutnKLEGSpZKIfws19AzZLuqUIz7Lxr2WTU=" crossorigin=anonymous></script>
<script defer src=../../../js/click-to-copy.min.f724d3de49218995223b7316aa2e53e2b34bf42026bf399ebb21bb02212402d1.js integrity="sha256-9yTT3kkhiZUiO3MWqi5T4rNL9CAmvzmeuyG7AiEkAtE=" crossorigin=anonymous></script>
<script src=../../../js/tabpane-persist.js></script></body></html>